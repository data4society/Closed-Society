(function(e){"use strict";var t;var n=e.Backbone;var r=e._;var i=n.$;var s=e.console&&e.console.warn;var o=e.console&&e.console.trace;var u=n.View.prototype._configure;var a=n.View.prototype.render;var f=Array.prototype.push;var l=Array.prototype.concat;var c=Array.prototype.splice;var h=n.View.extend({constructor:function(t){t=t||{};h.setupView(this,t);n.View.call(this,t)},insertView:function(e,t){if(t){return this.setView(e,t,true)}return this.setView(e,true)},insertViews:function(e){if(r.isArray(e)){return this.setViews({"":e})}r.each(e,function(t,n){e[n]=r.isArray(t)?t:[t]});return this.setViews(e)},getView:function(e){if(e==null){e=arguments[1]}return this.getViews(e).first().value()},getViews:function(e){var t;if(typeof e==="string"){t=this.views[e]||[];return r.chain([].concat(t))}t=r.chain(this.views).map(function(e){return r.isArray(e)?e:[e]},this).flatten();if(typeof e==="object"){return t.where(e)}return typeof e==="function"?t.filter(e):t},removeView:function(e){return this.getViews(e).each(function(e){e.remove()})},setView:function(e,t,n){var i,s,o;var u=this;if(typeof e!=="string"){n=t;t=e;e=""}this.views=this.views||{};i=t.__manager__;s=this.views[e];if(!i){throw new Error("Please set `View#manage` property with selector '"+e+"' to `true`.")}o=t.getAllOptions();i.parent=u;i.selector=e;t.on("all",function(e){if(e!=="beforeRender"&&e!=="afterRender"){u.trigger.apply(u,arguments)}},t);if(!n){if(i.hasRendered){o.partial(u.$el,t.$el,u.__manager__,i)}if(s){r.each(l.call([],s),function(e){e.remove()})}return this.views[e]=t}this.views[e]=l.call([],s||[],t);i.insert=true;return t},setViews:function(e){r.each(e,function(e,t){if(r.isArray(e)){return r.each(e,function(e){this.insertView(t,e)},this)}this.setView(t,e)},this);return this},render:function(){function c(){function c(){var r=n.afterRender;if(r){r.call(t,t)}t.trigger("afterRender",t);if(i.noel&&t.$el.length>1){if(s&&!n.suppressWarnings){e.console.warn("Using `el: false` with multiple top level "+"elements is not supported.");if(o){e.console.trace()}}}}var r,f;if(u){if(!n.contains(u.el,t.el)){n.partial(u.$el,t.$el,a,i)}}t.delegateEvents();i.hasRendered=true;if(r=i.queue.shift()){r()}else{delete i.queue}if(a&&a.queue){u.once("afterRender",c)}else{c()}return l.resolveWith(t,[t])}function p(){var e=t.getAllOptions();var n=t.__manager__;var i=n.parent;var s=i&&i.__manager__;t._render(h._viewRender,e).done(function(){if(!r.keys(t.views).length){return c()}var n=r.map(t.views,function(e){var t=r.isArray(e);if(t&&e.length){return r.reduce(e.slice(1),function(e,t){return e.then(function(){return t.render()})},e[0].render())}return!t?e.render():e});e.when(n).done(c)})}var t=this;var n=t.getAllOptions();var i=t.__manager__;var u=i.parent;var a=u&&u.__manager__;var l=n.deferred();if(i.queue){f.call(i.queue,p)}else{i.queue=[];p(t,l)}l.view=t;return l},remove:function(){h._removeView(this,true);return this._remove.apply(this,arguments)},getAllOptions:function(){return r.extend({},this,h.prototype.options,this.options)}},{_cache:{},_makeAsync:function(e,t){var n=e.deferred();n.async=function(){n._isAsync=true;return t};return n},_viewRender:function(e,t){function f(n){if(r.isString(n)){if(a.noel){n=i.trim(n);u=i(n);e.$el.slice(1).remove();e.$el.replaceWith(u);e.setElement(u,false)}else{t.html(e.$el,n)}}o.resolveWith(e,[e])}function l(e,r){var i;var s=h._makeAsync(t,function(e){f(e)});h.cache(n,r);if(r){i=t.render.call(s,r,e)}if(!s._isAsync){f(i)}}var n,s,o,u;var a=e.__manager__;return{render:function(){var i=e.serialize||t.serialize;var u=e.template||t.template;if(r.isFunction(i)){i=i.call(e)}o=h._makeAsync(t,function(e){l(i,e)});if(typeof u==="string"){n=t.prefix+u}if(s=h.cache(n)){l(i,s,n);return o}if(typeof u==="string"){s=t.fetch.call(o,t.prefix+u)}else if(typeof u==="function"){s=u}else if(u!=null){s=t.fetch.call(o,u)}if(!o._isAsync){l(i,s)}return o}}},_removeViews:function(e,t){var n;if(typeof e==="boolean"){t=e;e=this}e=e||this;e.getViews().each(function(e){if(e.__manager__.hasRendered||t){h._removeView(e,t)}})},_removeView:function(e,t){var n;var i=e.__manager__;var s=typeof e.keep==="boolean"?e.keep:e.options.keep;if(!s&&i.insert===true||t){h.cleanViews(e);e._removeViews(true);e.$el.remove();if(!i.parent){return}n=i.parent.views[i.selector];if(r.isArray(n)){return r.each(r.clone(n),function(e,t){if(e&&e.__manager__===i){c.call(n,t,1)}})}delete i.parent.views[i.selector]}},cache:function(e,t){if(e in this._cache&&t==null){return this._cache[e]}else if(e!=null&&t!=null){return this._cache[e]=t}},cleanViews:function(e){r.each(l.call([],e),function(e){var t;e.unbind();if(e.model instanceof n.Model){e.model.off(null,null,e)}if(e.collection instanceof n.Collection){e.collection.off(null,null,e)}e.stopListening();t=e.getAllOptions().cleanup;if(r.isFunction(t)){t.call(e)}})},configure:function(e){r.extend(h.prototype.options,e);if(e.manage){n.View.prototype.manage=true}if(e.el===false){n.View.prototype.el=false}if(e.suppressWarnings===true){n.View.prototype.suppressWarnings=true}},setupView:function(e,i){r.each(l.call([],e),function(e){if(e.__manager__){return}var s,o,u;var a=h.prototype;var f=r.pick(e,t);r.defaults(e,{views:{},__manager__:{},_removeViews:h._removeViews,_removeView:h._removeView},h.prototype);i=e.options=r.defaults(i||{},e.options,a.options);u=r.pick(i,l.call(["events"],r.values(i.events)));r.extend(e,u);if(f.render===h.prototype.render||f.render===n.View.prototype.render){delete f.render}r.extend(i,f);e._remove=n.View.prototype.remove;e._render=function(e,t){var n=this;var r=n.__manager__;var i=t.beforeRender;if(r.hasRendered){this._removeViews()}if(i){i.call(this,this)}this.trigger("beforeRender",this);return e(this,t).render()};e.render=h.prototype.render;if(e.remove!==a.remove){e._remove=e.remove;e.remove=a.remove}s=i.views||e.views;if(r.keys(s).length){o=s;e.views={};e.setViews(o)}if(e.options.template){e.options.template=i.template}else if(e.template){i.template=e.template}})}});n.Layout=h;h.VERSION="0.8.8";n.View.prototype._configure=function(e){var t,n;if("el"in e?e.el===false:this.el===false){t=true}n=u.apply(this,arguments);if(e.manage||this.manage){h.setupView(this)}if(this.__manager__){this.__manager__.noel=t;this.__manager__.suppressWarnings=e.suppressWarnings}return n};h.prototype.options={prefix:"",deferred:function(){return i.Deferred()},fetch:function(e){return r.template(i(e).html())},partial:function(e,t,n,r){if(r.selector){if(n.noel){var i=e.filter(r.selector);e=i.length?i:e.find(r.selector)}else{e=e.find(r.selector)}}if(r.insert){this.insert(e,t)}else{this.html(e,t)}},html:function(e,t){e.html(t)},insert:function(e,t){e.append(t)},when:function(e){return i.when.apply(null,e)},render:function(e,t){return e(t)},contains:function(e,t){return i.contains(e,t)}};t=r.keys(h.prototype.options)})(typeof global==="object"?global:this)